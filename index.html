document.getElementById('simBtn').onclick = async () => {
  const egg = document.getElementById('simEggSelect').value;
  const luck = (+document.getElementById('simYourLuck').value || 1) *
               (+document.getElementById('simEventLuck').value || 1) *
               (+document.getElementById('simAdminLuck').value || 1);
  const batches = +document.getElementById('simBatches').value || 100;
  const fast = document.getElementById('fastMode').checked;
  const container = document.getElementById('simOutput'); 
  container.innerHTML = '';

  const results = {};
  const expected = {};
  eggsData[egg].forEach(p => {
    results[p.name] = 0;
    expected[p.name] = Math.round(batches / (p.chance / luck));
  });

  const maxResult = batches;

  const render = () => {
    container.innerHTML = '';
    eggsData[egg].forEach(p => {
      const count = results[p.name];
      const label = document.createElement('div');
      label.innerHTML = `<span class="mini-icon">${p.icon}</span>${p.name}: ${count} / Expected: ${expected[p.name]}`;
      container.appendChild(label);

      const barCont = document.createElement('div');
      barCont.className = 'progress-container';

      const bar = document.createElement('div');
      bar.className = 'progress-bar';
      bar.style.backgroundColor = p.chance <= 100 ? '#ff5555' : p.chance <= 1000 ? '#55aaff' : '#55ff55';
      bar.style.width = Math.max(2, (count / maxResult) * 100) + '%';
      barCont.appendChild(bar);

      const expBar = document.createElement('div');
      expBar.className = 'progress-bar expected';
      expBar.style.width = Math.max(2, (expected[p.name] / maxResult) * 100) + '%';
      barCont.appendChild(expBar);

      container.appendChild(barCont);

      if (p.chance <= 100 && count > 0) {
        const eff = document.createElement('div');
        eff.style.color = '#ff0';
        eff.style.fontWeight = 'bold';
        eff.textContent = '✨ Ultra Rare Hatch! ✨';
        container.appendChild(eff);
      }
    });
  };

  // simulation
  for (let i = 0; i < batches; i++) {
    eggsData[egg].forEach(p => {
      if (Math.random() < (1 / (p.chance / luck))) results[p.name]++;
    });
    if (!fast) render();
  }

  render();
};
